############ ASSEMBLE TEST ##############
ADD_TEST(assemble-LHS ${CMAKE_CURRENT_BINARY_DIR}/assemble -LHS ${OpenMEEG_SOURCE_DIR}/HeadModels/Head1/Head1.geom ${OpenMEEG_SOURCE_DIR}/HeadModels/Head1/Head1.cond ${OpenMEEG_BINARY_DIR}/tests/lhsmatrix.bin)

ADD_TEST(minverser-lhsmatrix ${CMAKE_CURRENT_BINARY_DIR}/minverser ${OpenMEEG_BINARY_DIR}/tests/lhsmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/lhsinvmatrix.bin)

ADD_TEST(assemble-RHS ${CMAKE_CURRENT_BINARY_DIR}/assemble -RHS ${OpenMEEG_SOURCE_DIR}/HeadModels/Head1/Head1.geom ${OpenMEEG_SOURCE_DIR}/HeadModels/Head1/Head1.cond ${OpenMEEG_SOURCE_DIR}/HeadModels/Head1/Head1.tri ${OpenMEEG_BINARY_DIR}/tests/rhsmatrix.bin)

ADD_TEST(presmooth ${CMAKE_CURRENT_BINARY_DIR}/presmooth ${OpenMEEG_SOURCE_DIR}/HeadModels/Head1/Head1.tri ${OpenMEEG_BINARY_DIR}/tests/smoothmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/aivector.bin)

############ EEG TEST ##############
ADD_TEST(assemble-x2EEGresp ${CMAKE_CURRENT_BINARY_DIR}/assemble -xToEEGresponse ${OpenMEEG_SOURCE_DIR}/HeadModels/Head1/Head1.geom ${OpenMEEG_SOURCE_DIR}/HeadModels/Head1/Head1.cond ${OpenMEEG_SOURCE_DIR}/Computations/Head1/Head1.patches ${OpenMEEG_BINARY_DIR}/tests/x2eegmatrix.bin)

ADD_TEST(gain-EEG ${CMAKE_CURRENT_BINARY_DIR}/gain -EEG ${OpenMEEG_BINARY_DIR}/tests/lhsinvmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/rhsmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/x2eegmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/eeggainmatrix.bin)

#------ FORWARD -----#
ADD_TEST(forward-EEG ${CMAKE_CURRENT_BINARY_DIR}/forward -EEG ${OpenMEEG_BINARY_DIR}/tests/eeggainmatrix.bin ${OpenMEEG_SOURCE_DIR}/Computations/Head1/Head1.src ${OpenMEEG_BINARY_DIR}/tests/estimatedEEG.txt 0.0)

#------ INVERSE -----#
ADD_TEST(inverse-EEG-HEAT ${CMAKE_CURRENT_BINARY_DIR}/inverse -EEG ${OpenMEEG_BINARY_DIR}/tests/eeggainmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/smoothmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/aivector.bin ${OpenMEEG_BINARY_DIR}/tests/estimatedEEG.txt ${OpenMEEG_BINARY_DIR}/tests/estimatedSRCEEGHEAT.txt 1 1e-4 HEAT 10000 0.0)

ADD_TEST(inverse-EEG-MN ${CMAKE_CURRENT_BINARY_DIR}/inverse -EEG ${OpenMEEG_BINARY_DIR}/tests/eeggainmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/smoothmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/aivector.bin ${OpenMEEG_BINARY_DIR}/tests/estimatedEEG.txt ${OpenMEEG_BINARY_DIR}/tests/estimatedSRCEEGMN.txt 1 1e-4 MN 10000 0.0)

ADD_TEST(inverse-EEG-TV ${CMAKE_CURRENT_BINARY_DIR}/inverse -EEG ${OpenMEEG_BINARY_DIR}/tests/eeggainmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/smoothmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/aivector.bin ${OpenMEEG_BINARY_DIR}/tests/estimatedEEG.txt ${OpenMEEG_BINARY_DIR}/tests/estimatedSRCEEGTV.txt 1 1e-4 TV 10000 0.0)

############ MEG TEST ##############
ADD_TEST(assemble-x2MEGresp ${CMAKE_CURRENT_BINARY_DIR}/assemble -xToMEGresponseContrib ${OpenMEEG_SOURCE_DIR}/HeadModels/Head1/Head1.geom ${OpenMEEG_SOURCE_DIR}/HeadModels/Head1/Head1.cond ${OpenMEEG_SOURCE_DIR}/Computations/Head1/Head1.squids ${OpenMEEG_BINARY_DIR}/tests/x2megmatrix.bin)

ADD_TEST(assemble-s2MEGresp ${CMAKE_CURRENT_BINARY_DIR}/assemble -sToMEGresponseContrib ${OpenMEEG_SOURCE_DIR}/HeadModels/Head1/Head1.tri ${OpenMEEG_SOURCE_DIR}/Computations/Head1/Head1.squids ${OpenMEEG_BINARY_DIR}/tests/s2megmatrix.bin)

ADD_TEST(gain-MEG ${CMAKE_CURRENT_BINARY_DIR}/gain -MEG ${OpenMEEG_BINARY_DIR}/tests/lhsinvmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/rhsmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/x2megmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/s2megmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/meggainmatrix.bin)

#------ FORWARD -----#
ADD_TEST(forward-MEG ${CMAKE_CURRENT_BINARY_DIR}/forward -MEG ${OpenMEEG_BINARY_DIR}/tests/meggainmatrix.bin ${OpenMEEG_SOURCE_DIR}/Computations/Head1/Head1.src ${OpenMEEG_BINARY_DIR}/tests/estimatedMEG.txt 0.0)

#------ INVERSE -----#
ADD_TEST(inverse-MEG-HEAT ${CMAKE_CURRENT_BINARY_DIR}/inverse -MEG ${OpenMEEG_BINARY_DIR}/tests/meggainmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/smoothmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/aivector.bin ${OpenMEEG_BINARY_DIR}/tests/estimatedMEG.txt ${OpenMEEG_BINARY_DIR}/tests/estimatedSRCMEGHEAT.txt 1 1e-4 HEAT 10000 0.0)

ADD_TEST(inverse-MEG-MN ${CMAKE_CURRENT_BINARY_DIR}/inverse -MEG ${OpenMEEG_BINARY_DIR}/tests/meggainmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/smoothmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/aivector.bin ${OpenMEEG_BINARY_DIR}/tests/estimatedMEG.txt ${OpenMEEG_BINARY_DIR}/tests/estimatedSRCMEGMN.txt 1 1e-4 MN 10000 0.0)

ADD_TEST(inverse-MEG-TV ${CMAKE_CURRENT_BINARY_DIR}/inverse -MEG ${OpenMEEG_BINARY_DIR}/tests/meggainmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/smoothmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/aivector.bin ${OpenMEEG_BINARY_DIR}/tests/estimatedMEG.txt ${OpenMEEG_BINARY_DIR}/tests/estimatedSRCMEGTV.txt 1 1e-4 TV 10000 0.0)


############ TEST DIPOLE FORWARD RESULTS (Regression test) ##############

# assemble -rhsPOINT geometry.geom conductivity.cond dipoles.dip rhsmat.bin
ADD_TEST(assemble-rhsPOINT ${CMAKE_CURRENT_BINARY_DIR}/assemble -rhsPOINT ${OpenMEEG_SOURCE_DIR}/HeadModels/Head1/Head1.geom ${OpenMEEG_SOURCE_DIR}/HeadModels/Head1/Head1.cond ${OpenMEEG_SOURCE_DIR}/Computations/Head1/Head1.dip ${OpenMEEG_BINARY_DIR}/tests/rhspointmatrix.bin)

ADD_TEST(assemble-x2EEGrespPoint ${CMAKE_CURRENT_BINARY_DIR}/assemble -xToEEGresponse ${OpenMEEG_SOURCE_DIR}/HeadModels/Head1/Head1.geom ${OpenMEEG_SOURCE_DIR}/HeadModels/Head1/Head1.cond ${OpenMEEG_SOURCE_DIR}/Computations/Head1/Head1_scalp.patches ${OpenMEEG_BINARY_DIR}/tests/x2eegpointmatrix.bin)

# assemble -sToMEGresponseContrib_point dipoles.dip squidscoord.squids sToMEGmat.bin
ADD_TEST(assemble-sToMEGrespPoint ${CMAKE_CURRENT_BINARY_DIR}/assemble -sToMEGresponseContrib_point ${OpenMEEG_SOURCE_DIR}/Computations/Head1/Head1.dip ${OpenMEEG_SOURCE_DIR}/Computations/Head1/Head1.squids ${OpenMEEG_BINARY_DIR}/tests/s2megpointmatrix.bin)

ADD_TEST(gain-EEGPoint ${CMAKE_CURRENT_BINARY_DIR}/gain -EEG ${OpenMEEG_BINARY_DIR}/tests/lhsinvmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/rhspointmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/x2eegpointmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/eegpointgainmatrix.bin)

ADD_TEST(gain-MEGPoint ${CMAKE_CURRENT_BINARY_DIR}/gain -MEG ${OpenMEEG_BINARY_DIR}/tests/lhsinvmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/rhspointmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/x2megmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/s2megpointmatrix.bin ${OpenMEEG_BINARY_DIR}/tests/megpointgainmatrix.bin)

# forward -EEG gainmatrix.bin dipoleActivation.src estimatedeegdata.txt noiselevel
ADD_TEST(forward-EEG-dipoles ${CMAKE_CURRENT_BINARY_DIR}/forward -EEG ${OpenMEEG_BINARY_DIR}/tests/eegpointgainmatrix.bin ${OpenMEEG_SOURCE_DIR}/Computations/Head1/Head1.srcdip ${OpenMEEG_BINARY_DIR}/tests/estimatedEEGpoint.txt 0.0)

ADD_TEST(forward-MEG-dipoles ${CMAKE_CURRENT_BINARY_DIR}/forward -MEG ${OpenMEEG_BINARY_DIR}/tests/megpointgainmatrix.bin ${OpenMEEG_SOURCE_DIR}/Computations/Head1/Head1.srcdip ${OpenMEEG_BINARY_DIR}/tests/estimatedMEGpoint.txt 0.0)